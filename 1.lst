ARM GAS  1.s 			page 1


   1              		@@单片机stm32f030f4p6
   2              		@@电子天平
   3              		@作者：yjmwxwx
   4              		@时间：2019-12-01
   5              		@编译器：ARM-NONE-EABI
   6              		 .thumb
   7              		         .syntax unified
   8              		.section .data
   9              	shumaguanmabiao:
  10 0000 FC000000 		.int 0xfc,0x60,0xda,0xf2,0x66,0xb6,0xbe,0xe0,0xfe,0xf6
  10      60000000 
  10      DA000000 
  10      F2000000 
  10      66000000 
  11              	shumaguanshuaxinbiao:
  12 0028 00FE0000 		.int 0xfe00,0xfd00,0xfb00,0xf700,0xef00,0xdf00,0xbf00,0x7f00,0
  12      00FD0000 
  12      00FB0000 
  12      00F70000 
  12      00EF0000 
  13              	zheng_xian_biao:
  14 004c 30003300 		.short 0x30,0x33,0x36,0x38,0x3b,0x3e,0x41,0x44,0x47,0x49,0x4c,0x4e,0x50,0x52,0x54,0x56,0x58,0x59,0
  14      36003800 
  14      3B003E00 
  14      41004400 
  14      47004900 
  15              	shiyan:
  16 0114 55000000 		.int 0x55,0x66,0x77,0x88,0x99,0xaa
  16      66000000 
  16      77000000 
  16      88000000 
  16      99000000 
  17              	yjmwxwx:
  18 012c 796A6D77 		.ascii  "yjmwxwx-20191201-dian_zi_tian_ping"
  18      7877782D 
  18      32303139 
  18      31323031 
  18      2D646961 
  19              		.equ STACKINIT,        	        0x20001000
  20              		.equ shumaguanma,		0x20000000
  21              		.equ fuhao,			0x20000010
  22              		.equ jishu,			0x20000030
  23              		.equ lvboqizhizhen,		0x20000040
  24              		.equ lvboqihuanchong,		0x20000044
  25              		.equ dang_qin_cha,		0X20000dcc
  26              		.equ shang_ci_cha,		0x20000dd0
  27              		.equ shang_ci_i,		0x20000dd4
  28              		.equ anjianyanshi,		0x20000dd8
  29              		.equ zhongliang,		0x20000ddc
  30              		.equ dianyabiao,		0x20000de0
  31              		.equ lvboqizhizhen1,		0x20000f00
  32              		.equ lvboqihuanchong1,		0x20000f04
  33              		.section .text
  34              	vectors:
  35 0000 00100020 		.word STACKINIT
  36 0004 B1000000 		.word _start + 1
  37 0008 9B030000 		.word _nmi_handler + 1
ARM GAS  1.s 			page 2


  38 000c 9D030000 		.word _hard_fault  + 1
  39 0010 00000000 		.word 0
  40 0014 00000000 		.word 0
  41 0018 00000000 		.word 0
  42 001c 00000000 		.word 0
  43 0020 00000000 		.word 0
  44 0024 00000000 		.word 0
  45 0028 00000000 		.word 0
  46 002c 9F030000 		.word _svc_handler +1
  47 0030 00000000 		.word 0
  48 0034 00000000 		.word 0
  49 0038 A1030000 		.word _pendsv_handler +1
  50 003c A3030000 		.word _systickzhongduan +1               @ 15
  51 0040 B1030000 		.word aaa +1     @ _wwdg +1          @ 0
  52 0044 B1030000 		.word aaa +1     @_pvd +1            @ 1
  53 0048 B1030000 		.word aaa +1     @_rtc +1            @ 2
  54 004c B1030000 		.word aaa +1     @_flash +1          @ 3
  55 0050 B1030000 		.word aaa +1	@ _rcc + 1          @ 4
  56 0054 B1030000 		.word aaa +1      @_exti0_1  +1      @ 5
  57 0058 B1030000 		.word aaa +1      @ _exti2_3 +1      @ 6
  58 005c B1030000 		.word aaa +1       @_exti4_15 +1     @ 7
  59 0060 B1030000 		.word aaa +1                         @ 8
  60 0064 B1030000 		.word aaa +1 	@_dma1_1  +1    @ 9
  61 0068 B1030000 		.word aaa +1    @_dma1_2_3 +1        @ 10
  62 006c B1030000 		.word aaa +1       @_dma1_4_5 +1     @ 11
  63 0070 B1030000 		.word aaa +1	 @_adc1 +1          @ 12
  64 0074 B1030000 		.word aaa +1       @_tim1_brk_up +1  @ 13
  65 0078 B1030000 		.word aaa +1        @ _tim1_cc +1    @ 14
  66 007c B1030000 		.word aaa +1         @_tim2 +1       @ 15
  67 0080 B1030000 		.word aaa +1          @_tim3 +1      @ 16
  68 0084 B1030000 		.word aaa +1                         @ 17
  69 0088 B1030000 		.word aaa +1		                @ 18
  70 008c B1030000 		.word aaa +1	@_tim14 +1    @ 19
  71 0090 B1030000 		.word aaa +1                         @ 20
  72 0094 B1030000 		.word aaa +1         @_tim16 +1      @ 21
  73 0098 B1030000 		.word aaa +1         @_tim17 +1      @ 22
  74 009c B1030000 		.word aaa +1          @_i2c   +1     @ 23
  75 00a0 B1030000 		.word aaa +1                         @ 24
  76 00a4 B1030000 		.word aaa +1           @_spi   +1    @ 25
  77 00a8 B1030000 		.word aaa +1                         @ 26
  78 00ac B1030000 		.word aaa +1         @_usart1 +1     @ 27
  79              		.align 2
  80              	
  81              	_start:
  82              	shizhong:
  83 00b0 C04A     		ldr r2, = 0x40022000   @FLASH访问控制
  84 00b2 3221     		movs r1, # 0x32
  85 00b4 1160     		str r1, [r2]           @FLASH缓冲 缓冲开启
  86 00b6 C048     		ldr r0, = 0x40021000 @ rcc
  87 00b8 C049     		ldr r1, = 0x10001
  88 00ba 0160     		str r1, [r0]
  89              	denghse:
  90 00bc 0168     		ldr r1, [r0]
  91 00be 8903     		lsls r1, r1, # 14
  92 00c0 FCD5     		bpl denghse
  93              	dengpllguan:
  94 00c2 0168     		ldr r1, [r0]
ARM GAS  1.s 			page 3


  95 00c4 8901     		lsls r1, r1, # 6
  96 00c6 FCD4     		bmi dengpllguan
  97 00c8 BD49     	        ldr r1, = 0x110002
  98 00ca 4160     	        str r1, [r0, # 0x04]
  99 00cc BD49     		ldr r1, = 0x1010001
 100 00ce 0160     		str r1, [r0]
 101              	dengpll:
 102 00d0 0168     		ldr r1, [r0]
 103 00d2 8901     		lsls r1, # 6
 104 00d4 FCD5     		bpl dengpll
 105              		@0x34时钟控制寄存器 2 (RCC_CR2)
 106 00d6 0121     		movs r1, # 0x01
 107 00d8 4163     		str r1, [r0, # 0x34]  @ HSI开14M时钟
 108              	dengdai14mshizhongwending:
 109 00da 416B     		ldr r1, [r0, # 0x34]
 110 00dc 8907     		lsls r1, r1, # 30     @ 左移30位
 111 00de FCD5     		bpl dengdai14mshizhongwending  @ 等待14M时钟稳定
 112              	
 113              	_neicunqingling:
 114 00e0 B948     		ldr r0, = 0x20000000
 115 00e2 0021     		movs r1, # 0
 116 00e4 B94B     		ldr r3, = 0x1000
 117              	_neicunqinglingxunhuan:
 118 00e6 043B     		subs r3, # 4
 119 00e8 C150     		str r1, [r0, r3]
 120 00ea FCD1     		bne _neicunqinglingxunhuan
 121              	
 122              	_waisheshizhong:			 @ 外设时钟
 123              		@ +0x14=RCC_AHBENR
 124              		@ 0=DMA 2=SRAM 4=FLITF 6=CRC  17=PA  18=PB 19=PC 20=PD 22=PF
 125 00ec B248     		ldr r0, = 0x40021000
 126 00ee B849     		ldr r1, = 0x460005
 127 00f0 4161     		str r1, [r0, # 0x14]
 128              	
 129              		@ +0x18外设时钟使能寄存器 (RCC_APB2ENR)
 130              		@ 0=SYSCFG 5=USART6EN 9=ADC 11=TIM1 12=SPI1 14=USART1
 131              		@ 16=TIM15 17=TIM16 18=TIM17 22=DBGMCU
 132 00f2 B849     		ldr r1, = 0xa00
 133 00f4 8161     		str r1, [r0, # 0x18]
 134              		@+0X1C=RCC_APB1ENR
 135              		@ 1=TIM3 4=TIM6 5=TIM7 8=TIM14 11=WWDG 14=SPI 17=USRT2 18=USART3
 136              		@ 20=USART5 21=I2C1 22=I2C2  23=USB 28=PWR
 137 00f6 0221     		movs r1, # 0x02
 138 00f8 C161     		str r1, [r0, # 0x1c]
 139              	
 140              	
 141              	_waishezhongduan:				@外设中断
 142              		@0xE000E100    0-31  写1开，写0没效
 143              		@0XE000E180    0-31 写1关，写0没效
 144              		@0XE000E200    0-31 挂起，写0没效
 145              		@0XE000E280    0-31 清除， 写0没效
 146              	
 147              	@_systick:				@ systick定时器初始化
 148              	
 149              	@	ldr r0, = 0xe000e010
 150              	@	ldr r1, = 0xffffff
 151              	@	str r1, [r0, # 4]
ARM GAS  1.s 			page 4


 152              	@	str r1, [r0, # 8]
 153              	@	movs r1, # 0x07
 154              	@	str r1, [r0]
 155              		
 156              	io_she_zhi:
 157              		@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
 158              		@a(0x48000000)b(0x48000400)c(0x48000800)d(0x48000c00)f(0x48001400)
 159              		@ 输入（00），通用输出（01），复用功能（10），模拟（11）
 160              		@偏移0x4 = 端口输出类型 @ （0 推挽），（ 1 开漏）
 161              		@偏移0x8 = 输出速度  00低速， 01中速， 11高速
 162              		@偏移0xC = 上拉下拉 (00无上下拉，  01 上拉， 10下拉)
 163              		@偏移0x10 = 输入数据寄存器
 164              		@偏移0x14 = 输出数据寄存器
 165              		@偏移0x18 = 端口开  0-15置位
 166              		@偏移0x28 = 端口关
 167              		@0X20 = 复用低
 168              		@GPIO口0（0-3位）每个IO口占用4位
 169              		@ AF0 = 0X0000, AF1 = 0X0001, AF2 = 0X0010 AF3 = 0X0011, AF4 = 0X0100
 170              		@ AF5 = 0X0101, AF6 = 0X0111, AF7 = 0X1000
 171              		@0x24 = 复用高
 172              		@GPIO口8 （0-3位）每个IO口占用4位
 173              		@ AF0 = 0X0000, AF1 = 0X0001, AF2 = 0X0010 AF3 = 0X0011, AF4 = 0X0100
 174              		@ AF5 = 0X0101, AF6 = 0X0111, AF7 = 0X1000
 175              		@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
 176              	
 177 00fa B748     		ldr r0, = 0x48000000
 178 00fc B749     		ldr r1, = 0x2800a15b
 179 00fe 0160     		str r1, [r0]
 180              	
 181 0100 B749     		ldr r1, = 0x40400
 182 0102 C160     		str r1, [r0, # 0x0c] @pa5 pa9上拉
 183              		
 184 0104 B749     		ldr r1, = 0x11000000
 185 0106 0162     		str r1, [r0, # 0x20]	@ pa6\pa7 TIM3
 186              	
 187 0108 B748     		ldr r0, = 0x48000400
 188 010a 0821     		movs r1, # 0x08 @ pb1
 189 010c 0160     		str r1, [r0]
 190 010e 2021     		movs r1, # 0x20
 191 0110 0162     		str r1, [r0, # 0x20]
 192              	
 193              	_adcchushihua:
 194 0112 B648     	        ldr r0, = 0x40012400  @ adc基地址
 195 0114 B649     	        ldr r1, = 0x80000000
 196 0116 8160     	        str r1, [r0, # 0x08]  @ ADC 控制寄存器 (ADC_CR)  @adc校准
 197              	_dengadcjiaozhun:
 198 0118 8168     	        ldr r1, [r0, # 0x08]
 199 011a 0900     	        movs r1, r1
 200 011c FCD4     	        bmi _dengadcjiaozhun   @ 等ADC校准
 201              	_kaiadc:
 202 011e 8168     		ldr r1, [r0, # 0x08]
 203 0120 0122     	        movs r2, # 0x01
 204 0122 1143     		orrs r1, r1, r2
 205 0124 8160     	        str r1, [r0, # 0x08]
 206              	_dengdaiadcwending:
 207 0126 0168     		ldr r1, [r0]
 208 0128 C907     		lsls r1, r1, # 31
ARM GAS  1.s 			page 5


 209 012a FCD5     		bpl _dengdaiadcwending @ 等ADC稳定
 210              	_tongdaoxuanze:
 211 012c B149     		ldr r1, = 1
 212 012e 8162     	        str r1, [r0, # 0x28]    @ 通道选择寄存器 (ADC_CHSELR)
 213 0130 B149     	        ldr r1, = 0x803
 214 0132 C160     	        str r1, [r0, # 0x0c]    @ 配置寄存器 1 (ADC_CFGR1)
 215 0134 0021     		movs r1, # 0
 216 0136 4161     	        str r1, [r0, # 0x14]    @ ADC 采样时间寄存器 (ADC_SMPR)
 217 0138 8168     		ldr r1, [r0, # 0x08]
 218 013a B04A     	        ldr r2, = 0x04         @ 开始转换
 219 013c 1143     	        orrs r1, r1, r2
 220 013e 8160     		str r1, [r0, # 0x08]    @ 控制寄存器 (ADC_CR)
 221              	
 222              	
 223              		
 224              	dmachushihua:
 225              	        @+0=LSR,+4=IFCR,
 226              	        @+8=CCR1,+c=CNDTR1,+10=CPAR1+14=CMAR1,
 227              	        @+1c=CCR2,+20=CNDTR2,+24=CPAR2,+28=CMAR2
 228              	        @+30=CCR3,+34=CNDTR3,+38=CPAR2,+3c=CMAR3
 229              	        @+44=CCR4,+48=CNDTR4,+4c=CPAR4,+50=CMAR4
 230              	        @+58=CCR5,+5c=CNDTR5,+60=CPAR5,+64=CMAR5
 231              	        @+6C=CCR6,+70=CNDTR6,+74=CPAR6,+78=CMAR6
 232              	        @+80=CCR7,+84=CNDTR7,+88=CPAR7,+8c=CMAR7
 233              	
 234              	        @tim1ch3DMA
 235 0140 AF48     	        ldr r0, = 0x40020000
 236 0142 B049     	        ldr r1, = 0x40012c3c @ 外设地址
 237 0144 0166     	        str r1, [r0, # 0x60]
 238 0146 B049     	        ldr r1, = zheng_xian_biao @ 储存器地址
 239 0148 4166     	        str r1, [r0, # 0x64]
 240 014a B049     	        ldr r1, = 100             @点数
 241 014c C165     	        str r1, [r0, # 0x5c]
 242 014e B049     	        ldr r1, = 0x35b1         @ 储存到外设
 243 0150 8165     	        str r1, [r0, # 0x58]
 244              		@ adc dma
 245 0152 AB48     		ldr r0, = 0x40020000
 246 0154 AF49     		ldr r1, = 0x40012440
 247 0156 0161     		str r1, [r0, # 0x10]
 248 0158 AF49     		ldr r1, = dianyabiao
 249 015a 4161     		str r1, [r0, # 0x14]
 250 015c AB49     		ldr r1, =  100
 251 015e C160     		str r1, [r0, # 0x0c]
 252 0160 AE49     		ldr r1, = 0x5a1		@ 5a1
 253 0162 8160     		str r1, [r0, # 0x08]
 254              	
 255              		
 256              	tim1chushihua:
 257 0164 AE48     	        ldr r0, = 0x40012c00 @ tim1_cr1
 258 0166 0021     	        movs r1, # 0
 259 0168 8162     	        str r1, [r0, # 0x28] @ psc
 260 016a AE49     	        ldr r1, = 96
 261 016c C162     	        str r1, [r0, # 0x2c] @ ARR
 262              		@	movs r1, # 0x40
 263 016e 2021     		movs r1, # 0x20
 264 0170 4160     		str r1, [r0, # 0x04] @ TRGO
 265 0172 3821     		movs r1, # 0x38
ARM GAS  1.s 			page 6


 266 0174 8161     		str r1, [r0, # 0x18] @ ccmr1 cc1
 267 0176 6021     		movs r1, # 96
 268 0178 4163     		str r1, [r0, # 0x34]
 269 017a AB49     	        ldr r1, = 0x68
 270 017c C161     	        str r1, [r0, # 0x1c] @ ccmr2  CC3
 271 017e AB49     	        ldr r1, = 0x400    @  CC3
 272 0180 0162     	        str r1, [r0, # 0x20] @ ccer
 273 0182 AB49     	        ldr r1, = 0x8000
 274 0184 4164     	        str r1, [r0, # 0x44] @ BDTR
 275 0186 AB49     	        ldr r1, = 0x800 @ CC3 DMA
 276 0188 C160     	        str r1, [r0, # 0x0c] @ DIER
 277 018a AB49     	        ldr r1, = 0x81
 278 018c 0160     	        str r1, [r0]
 279              	
 280              	_tim3chushiha:				
 281 018e AB48     		ldr r0, = 0x40000400 @ tim3_cr1
 282 0190 0021     		movs r1, # 0
 283 0192 8162     		str r1, [r0, # 0x28] @ psc
 284 0194 AA49     		ldr r1, = 4800
 285 0196 C162     		str r1, [r0, # 0x2c] @ ARR
 286 0198 AA49     		ldr r1, = 0x6868
 287 019a 8161     		str r1, [r0, # 0x18] @ ccmr1
 288 019c 1121     		movs r1, # 0x11
 289 019e 0162     		str r1, [r0, # 0x20] @ ccer
 290 01a0 9449     		ldr r1, = 1
 291 01a2 4163     		str r1, [r0, # 0x34]
 292 01a4 9949     		ldr  r1, = 100
 293 01a6 8163     		str r1, [r0, # 0x38]
 294 01a8 8121     		movs r1, # 0x81
 295 01aa 0160     		str r1, [r0]
 296              	_tingting:
 297              	@	ldr r0, = 0x20000530
 298              		@	ldr r2, = 0x20000590
 299 01ac 9A48     		ldr r0, = dianyabiao
 300 01ae 0200     		movs r2, r0
 301 01b0 3030     		adds r0, r0, # 0x30
 302 01b2 9032     		adds r2, r2, # 0x90
 303 01b4 0188     		ldrh r1, [r0]
 304 01b6 1388     		ldrh r3, [r2]
 305 01b8 5B1A     		subs r3, r3, r1
 306 01ba A348     		ldr r0, = lvboqihuanchong1
 307 01bc A34A     		ldr r2, = lvboqizhizhen1
 308 01be 1221     		movs r1, # 18
 309 01c0 00F0B2F8 		bl __lvboqi32
 310 01c4 0346     		mov r3, r0
 311 01c6 0021     		movs r1, # 0
 312 01c8 1846     		mov r0, r3
 313 01ca 401A     		subs r0, r0, r1
 314 01cc 00F01CF8 		bl __pid
 315              	@	b __xian_shi_wei_zhi
 316              	__xian_shi_zhong_liang:
 317 01d0 9F48     		ldr r0, = zhongliang
 318 01d2 0368     		ldr r3, [r0]
 319 01d4 0AE0     		b __led_xian_shi
 320              	__xian_shi_wei_zhi:
 321 01d6 1B00     		movs r3, r3
 322 01d8 05D5     		bpl __bu_shi_fu_shu
ARM GAS  1.s 			page 7


 323 01da DB43     		mvns r3, r3
 324 01dc 0133     		adds r3, r3, # 1
 325 01de 9D48     		ldr r0, = fuhao
 326 01e0 0021     		movs r1, # 0
 327 01e2 0160     		str r1, [r0]
 328 01e4 02E0     		b __led_xian_shi
 329              	__bu_shi_fu_shu:
 330 01e6 9B48     		ldr r0, = fuhao
 331 01e8 0221     		movs r1, # 0x02
 332 01ea 0160     		str r1, [r0]
 333              	__led_xian_shi:	
 334 01ec 9A48     		ldr r0, = lvboqihuanchong
 335 01ee 8F49     		ldr r1, = 1024
 336 01f0 9A4A     		ldr r2, = lvboqizhizhen
 337 01f2 00F085F8 		bl _lvboqi
 338 01f6 0421     		movs r1, # 4
 339 01f8 734A     	        ldr r2, = shumaguanma
 340 01fa FF23     		movs r3, # 0xff		@小数点位置
 341 01fc 00F034F8 	        bl _zhuanshumaguanma
 342 0200 0520     		movs r0, # 5
 343 0202 00F048F8 	        bl _xieshumaguan
 344 0206 D1E7     		b _tingting
 345              	
 346              	__pid:
 347              		@ 入口r0=e(t)当前差多少
 348 0208 FCB5     		push {r2-r7,lr}
 349 020a 0446     		mov r4, r0
 350 020c 0546     		mov r5, r0
 351              	__bi_li:
 352 020e 944A     		ldr r2, = 45000		@ KP
 353 0210 5043     		muls r0, r0, r2
 354 0212 C013     		asrs r0, r0, # 15
 355              	__ji_fen:
 356 0214 934F     		ldr r7, = shang_ci_i
 357 0216 7D4A     		ldr r2, = 100		@ KI
 358 0218 3B68     		ldr r3, [r7]
 359 021a 5443     		muls r4, r4, r2
 360 021c E413     		asrs r4, r4, # 15
 361 021e E418     		adds r4, r4, r3
 362 0220 3C60     		str r4, [r7]
 363              	__wei_fen:
 364 0222 914F     		ldr r7, = shang_ci_cha
 365 0224 914A     		ldr r2, = 700000		@ KD	
 366 0226 3B68     		ldr r3, [r7]
 367 0228 3D60     		str r5, [r7]
 368 022a ED1A     		subs r5, r5, r3
 369 022c 5543     		muls r5, r5, r2
 370 022e ED13     		asrs r5, r5, # 15
 371              	__pid_shu_chu:
 372 0230 0019     		adds r0, r0, r4
 373 0232 4019     		adds r0, r0, r5
 374 0234 00F001F8 		bl __dian_ci_tie
 375 0238 FCBD     		pop {r2-r7,pc}
 376              		
 377              		
 378              	__dian_ci_tie:
 379              		@ 入口 R0=输入值
ARM GAS  1.s 			page 8


 380 023a 0EB5     		push {r1-r3,lr}
 381 023c 7F49     		ldr r1, = 0x40000400
 382 023e 804B     		ldr r3, = 4800
 383 0240 0000     		movs r0, r0
 384 0242 0AD5     		bpl __dian_ci_tie_shang
 385              	__dian_ci_tie_xia:
 386 0244 C043     		mvns r0, r0
 387 0246 0130     		adds r0, r0, # 1
 388 0248 9842     		cmp r0, r3
 389 024a 00D9     		bls __xia_shu_chu
 390 024c 1846     		mov r0, r3
 391              	__xia_shu_chu:	
 392 024e 0022     		movs r2, # 0
 393 0250 7F4B     		ldr r3, = zhongliang
 394 0252 4A63     		str r2, [r1, # 0x34]
 395 0254 8863     		str r0, [r1, # 0x38]
 396 0256 1860     		str r0, [r3]
 397 0258 0EBD     		pop {r1-r3,pc}
 398              	__dian_ci_tie_shang:
 399 025a 9842     		cmp r0, r3
 400 025c 00D9     		bls __shang_shu_chu
 401 025e 1846     		mov r0, r3
 402              	__shang_shu_chu:	
 403 0260 0022     		movs r2, # 0
 404 0262 8A63     		str r2, [r1, # 0x38]
 405 0264 4863     		str r0, [r1, # 0x34]
 406 0266 0EBD     		pop {r1-r3,pc}
 407              	
 408              	_zhuanshumaguanma:@ 16进制转数码管码
 409              		@ R0要转的数据， R1长度，R2结果表首地址
 410              		@ r3 小数点位置
 411 0268 F0B5     		push {r4-r7,lr}
 412 026a 814F     		ldr r7, = shumaguanmabiao
 413 026c 0546     		mov r5, r0
 414 026e 0E46     		mov r6, r1
 415 0270 0A21     		movs r1, # 10
 416 0272 9846     		mov r8, r3
 417              	_xunhuanqiuma:
 418 0274 00F07EF8 		bl _chufa
 419 0278 0446     		mov r4, r0
 420 027a 4C43     		muls r4, r1
 421 027c 2B1B     		subs r3, r5, r4
 422 027e 9B00     		lsls r3, # 2
 423 0280 FC58     		ldr r4, [r7, r3]
 424 0282 4645     		cmp r6, r8
 425 0284 00D0     		beq __tian_jia_xiao_shu_dian
 426 0286 00E0     		b __bao_cun_shu_ma_guan_ma
 427              	__tian_jia_xiao_shu_dian:
 428 0288 0134     		adds r4, r4, # 1
 429              	__bao_cun_shu_ma_guan_ma:	
 430 028a 1460     		str r4, [r2]
 431 028c 0546     		mov r5, r0
 432 028e 0432     		adds r2, r2, # 4
 433 0290 013E     		subs r6, # 1
 434 0292 EFD1     		bne _xunhuanqiuma
 435 0294 F0BD     		pop {r4-r7,pc}
 436              	_xieshumaguan: @ r0=位数 @数码管码
ARM GAS  1.s 			page 9


 437 0296 FEB5     		push {r1-r7,lr}
 438 0298 8000     		lsls r0, r0, # 2
 439 029a 0027     		movs r7, # 0
 440 029c 0646     		mov r6, r0
 441 029e 4A4D     		ldr r5, = shumaguanma
 442 02a0 744A     		ldr r2, = shumaguanshuaxinbiao
 443              	_shumaguanshuaxin:
 444 02a2 EB59     		ldr r3, [r5, r7]
 445 02a4 D459     		ldr r4, [r2, r7]
 446 02a6 1C43     		orrs r4, r4, r3
 447 02a8 2046     		mov r0, r4
 448 02aa 00F004F8 		bl _xie595
 449 02ae 0437     		adds  r7, r7, # 4
 450 02b0 B742     		cmp r7, r6
 451 02b2 F6D9     		bls _shumaguanshuaxin
 452 02b4 FEBD     		pop {r1-r7,pc}
 453              		
 454              	_xie595: @ R0=要写的数据
 455 02b6 FEB5     		push {r1-r7,lr}
 456 02b8 0546     		mov r5, r0
 457 02ba 0820     		movs r0, # 0x08      @pa6
 458 02bc 1027     		movs r7, # 0x10      @pa7
 459 02be 0426     		movs r6, # 0x04      @pa5 
 460 02c0 1023     		movs r3, # 16   @16位
 461 02c2 454A     		ldr r2, = 0x48000000 @ gpioa
 462 02c4 0121     		movs r1, # 0x01
 463              	_xunhuan595:
 464 02c6 9761     		str r7, [r2, # 0x18]
 465 02c8 00F014F8 		bl _yanshi
 466 02cc 0D42     		tst r5, r1
 467 02ce 01D1     		bne _xie595_0
 468 02d0 9062     		str r0, [r2, # 0x28]
 469 02d2 00E0     		b _suocun595
 470              	_xie595_0:
 471 02d4 9061     		str r0, [r2, # 0x18]
 472              	_suocun595:
 473 02d6 00F00DF8 		bl _yanshi
 474 02da 6D08     		lsrs r5, # 1
 475 02dc 9762     		str r7, [r2, # 0x28]
 476 02de 00F009F8 		bl _yanshi
 477 02e2 013B     		subs r3, r3, # 1
 478 02e4 EFD1     		bne _xunhuan595
 479 02e6 9661     		str r6, [r2, # 0x18]
 480 02e8 00F004F8 		bl _yanshi
 481 02ec 9662     		str r6, [r2, # 0x28]
 482 02ee 00F001F8 		bl _yanshi
 483 02f2 FEBD     		pop {r1-r7,pc}
 484              	
 485              	
 486              	_yanshi:
 487 02f4 80B4     		push {r7}
 488 02f6 604F     		ldr r7, = 30
 489              	_yanshi11:
 490 02f8 013F     		subs r7, # 1
 491 02fa FDD1     		bne _yanshi11
 492 02fc 80BC     		pop {r7}
 493 02fe 7047     		bx lr
ARM GAS  1.s 			page 10


 494              	_lvboqi:				@滤波器
 495              				@R0=地址，R1=长度,r2=表指针地址,r3=ADC数值
 496              				@出R0=结果
 497 0300 FEB5     		push {r1-r7,lr}	
 498 0302 1568     		ldr r5, [r2]		@读出表指针
 499 0304 4E00     		lsls r6, r1, # 1	
 500 0306 4353     		strh r3, [r0, r5]	@数值写到滤波器缓冲区
 501 0308 0235     		adds r5, r5, # 2
 502 030a B542     		cmp r5, r6
 503 030c 00D1     		bne _lvboqimeidaohuanchongquding
 504 030e 0025     		movs r5, # 0
 505              	_lvboqimeidaohuanchongquding:
 506 0310 1560     		str r5, [r2]
 507 0312 0027     		movs r7, # 0
 508              	_lvboqixunhuan:
 509 0314 B542     		cmp r5, r6
 510 0316 00D1     		bne _lvbozonghe
 511 0318 0025     		movs r5, # 0
 512              	_lvbozonghe:
 513 031a 445B     		ldrh r4, [r0, r5]
 514 031c 0235     		adds r5, r5, # 2
 515 031e 3F19     		adds r7, r7, r4
 516 0320 0139     		subs r1, r1, # 1
 517 0322 F7D1     		bne _lvboqixunhuan
 518 0324 B812     		asrs r0, r7, # 10	@修改
 519 0326 FEBD     		pop {r1-r7,pc}
 520              	
 521              	__lvboqi32:                                @滤波器
 522              	                        @R0=地址，R1=长度,r2=表指针地址,r3=ADC数值
 523              		                @出R0=结果
 524 0328 F0B5     	        push {r4-r7,lr}
 525 032a 1568     	        ldr r5, [r2]            @读出表指针
 526 032c 8E00     		lsls r6, r1, # 2
 527 032e 4351     	        str r3, [r0, r5]       @数值写到滤波器缓冲区
 528 0330 0435     	        adds r5, r5, # 4
 529 0332 B542     		cmp r5, r6
 530 0334 00D1     		bne _lvboqimeidaohuanchongquding32
 531 0336 0025     	        movs r5, # 0
 532              	_lvboqimeidaohuanchongquding32:
 533 0338 1560     		str r5, [r2]
 534 033a 0022     		movs r2, # 0
 535 033c 0346     		mov r3, r0
 536 033e 5030     		adds r0, r0, # 0x50
 537              	__fu_zhi_lv_bo_shu_ju:
 538 0340 9C58     		ldr r4, [r3, r2]
 539 0342 8450     		str r4, [r0, r2]
 540 0344 0432     		adds r2, r2, # 4
 541 0346 482A     		cmp r2, # 0x48
 542 0348 FAD1     		bne __fu_zhi_lv_bo_shu_ju
 543              	__qu_diao_zui_da_zui_xiao:	
 544 034a 0022     		movs r2, # 0
 545 034c 1346     		mov r3, r2
 546              	__qu_diao_da:
 547 034e 8158     		ldr r1, [r0, r2]
 548 0350 9942     		cmp r1, r3
 549 0352 01D3     		bcc __di_zhi_jia
 550 0354 8350     		str r3, [r0, r2]
ARM GAS  1.s 			page 11


 551 0356 0B46     		mov r3, r1
 552              	__di_zhi_jia:	
 553 0358 0432     		adds r2, r2, # 4
 554 035a 402A     		cmp r2, # 0x40
 555 035c F7D9     		bls __qu_diao_da
 556 035e 0022     		movs r2, # 0
 557 0360 1446     		mov r4, r2
 558 0362 0830     		adds r0, r0, # 0x08
 559              	__xun_huan_jia:	
 560 0364 8358     		ldr r3, [r0, r2]
 561 0366 E418     		adds r4, r4, r3
 562 0368 0432     		adds r2, r2, # 4
 563 036a 402A     		cmp r2, # 0x40
 564 036c FAD9     		bls __xun_huan_jia
 565 036e 2046     		mov r0, r4
 566 0370 0011     		asrs r0, r0, # 4
 567 0372 F0BD     		pop {r4-r7,pc}
 568              	
 569              	
 570              	_chufa:				@软件除法
 571              		@ r0 除以 r1 等于 商(r0)余数R1
 572 0374 1EB5     		push {r1-r4,lr}
 573 0376 0028     		cmp r0, # 0
 574 0378 0ED0     		beq _chufafanhui
 575 037a 0029     		cmp r1, # 0
 576 037c 0CD0     		beq _chufafanhui
 577 037e 0246     		mov r2, r0
 578 0380 0123     		movs r3, # 1
 579 0382 DB07     		lsls r3, r3, # 31
 580 0384 0020     		movs r0, # 0
 581 0386 0446     		mov r4, r0
 582              	_chufaxunhuan:
 583 0388 5200     		lsls r2, r2, # 1
 584 038a 6441     		adcs r4, r4, r4
 585 038c 8C42     		cmp r4, r1
 586 038e 01D3     		bcc _chufaweishubudao0
 587 0390 C018     		adds r0, r0, r3
 588 0392 641A     		subs r4, r4, r1
 589              	_chufaweishubudao0:
 590 0394 5B08     		lsrs r3, r3, # 1
 591 0396 F7D1     		bne _chufaxunhuan
 592              	_chufafanhui:
 593 0398 1EBD     		pop {r1-r4,pc}
 594              	_nmi_handler:
 595 039a 7047     		bx lr
 596              	_hard_fault:
 597 039c 7047     		bx lr
 598              	_svc_handler:
 599 039e 7047     		bx lr
 600              	_pendsv_handler:
 601 03a0 7047     		bx lr
 602              	_systickzhongduan:
 603 03a2 364A     		ldr r2, = jishu
 604 03a4 3648     		ldr r0, = 0xe0000d04
 605 03a6 1368     		ldr r3, [r2]
 606 03a8 3649     		ldr r1, = 0x02000000
 607 03aa 0133     		adds r3, r3, # 1
ARM GAS  1.s 			page 12


 608 03ac 1360     		str r3, [r2]
 609 03ae 0160     		str r1, [r0]                 @ 清除SYSTICK中断
 610              	aaa:
 611 03b0 70470000 		bx lr
 611      00200240 
 611      00100240 
 611      01000100 
 611      02001100 
ARM GAS  1.s 			page 13


DEFINED SYMBOLS
                 1.s:9      .data:0000000000000000 shumaguanmabiao
                 1.s:11     .data:0000000000000028 shumaguanshuaxinbiao
                 1.s:13     .data:000000000000004c zheng_xian_biao
                 1.s:15     .data:0000000000000114 shiyan
                 1.s:17     .data:000000000000012c yjmwxwx
                 1.s:19     *ABS*:0000000020001000 STACKINIT
                 1.s:20     *ABS*:0000000020000000 shumaguanma
                 1.s:21     *ABS*:0000000020000010 fuhao
                 1.s:22     *ABS*:0000000020000030 jishu
                 1.s:23     *ABS*:0000000020000040 lvboqizhizhen
                 1.s:24     *ABS*:0000000020000044 lvboqihuanchong
                 1.s:25     *ABS*:0000000020000dcc dang_qin_cha
                 1.s:26     *ABS*:0000000020000dd0 shang_ci_cha
                 1.s:27     *ABS*:0000000020000dd4 shang_ci_i
                 1.s:28     *ABS*:0000000020000dd8 anjianyanshi
                 1.s:29     *ABS*:0000000020000ddc zhongliang
                 1.s:30     *ABS*:0000000020000de0 dianyabiao
                 1.s:31     *ABS*:0000000020000f00 lvboqizhizhen1
                 1.s:32     *ABS*:0000000020000f04 lvboqihuanchong1
                 1.s:34     .text:0000000000000000 vectors
                 1.s:81     .text:00000000000000b0 _start
                 1.s:594    .text:000000000000039a _nmi_handler
                 1.s:596    .text:000000000000039c _hard_fault
                 1.s:598    .text:000000000000039e _svc_handler
                 1.s:600    .text:00000000000003a0 _pendsv_handler
                 1.s:602    .text:00000000000003a2 _systickzhongduan
                 1.s:610    .text:00000000000003b0 aaa
                            .text:0000000000000000 $d
                 1.s:79     .text:00000000000000b0 $t
                 1.s:82     .text:00000000000000b0 shizhong
                 1.s:89     .text:00000000000000bc denghse
                 1.s:93     .text:00000000000000c2 dengpllguan
                 1.s:101    .text:00000000000000d0 dengpll
                 1.s:108    .text:00000000000000da dengdai14mshizhongwending
                 1.s:113    .text:00000000000000e0 _neicunqingling
                 1.s:117    .text:00000000000000e6 _neicunqinglingxunhuan
                 1.s:122    .text:00000000000000ec _waisheshizhong
                 1.s:141    .text:00000000000000fa _waishezhongduan
                 1.s:156    .text:00000000000000fa io_she_zhi
                 1.s:193    .text:0000000000000112 _adcchushihua
                 1.s:197    .text:0000000000000118 _dengadcjiaozhun
                 1.s:201    .text:000000000000011e _kaiadc
                 1.s:206    .text:0000000000000126 _dengdaiadcwending
                 1.s:210    .text:000000000000012c _tongdaoxuanze
                 1.s:224    .text:0000000000000140 dmachushihua
                 1.s:256    .text:0000000000000164 tim1chushihua
                 1.s:280    .text:000000000000018e _tim3chushiha
                 1.s:296    .text:00000000000001ac _tingting
                 1.s:521    .text:0000000000000328 __lvboqi32
                 1.s:346    .text:0000000000000208 __pid
                 1.s:316    .text:00000000000001d0 __xian_shi_zhong_liang
                 1.s:333    .text:00000000000001ec __led_xian_shi
                 1.s:320    .text:00000000000001d6 __xian_shi_wei_zhi
                 1.s:329    .text:00000000000001e6 __bu_shi_fu_shu
                 1.s:494    .text:0000000000000300 _lvboqi
                 1.s:408    .text:0000000000000268 _zhuanshumaguanma
ARM GAS  1.s 			page 14


                 1.s:436    .text:0000000000000296 _xieshumaguan
                 1.s:351    .text:000000000000020e __bi_li
                 1.s:355    .text:0000000000000214 __ji_fen
                 1.s:363    .text:0000000000000222 __wei_fen
                 1.s:371    .text:0000000000000230 __pid_shu_chu
                 1.s:378    .text:000000000000023a __dian_ci_tie
                 1.s:398    .text:000000000000025a __dian_ci_tie_shang
                 1.s:385    .text:0000000000000244 __dian_ci_tie_xia
                 1.s:391    .text:000000000000024e __xia_shu_chu
                 1.s:402    .text:0000000000000260 __shang_shu_chu
                 1.s:417    .text:0000000000000274 _xunhuanqiuma
                 1.s:570    .text:0000000000000374 _chufa
                 1.s:427    .text:0000000000000288 __tian_jia_xiao_shu_dian
                 1.s:429    .text:000000000000028a __bao_cun_shu_ma_guan_ma
                 1.s:443    .text:00000000000002a2 _shumaguanshuaxin
                 1.s:454    .text:00000000000002b6 _xie595
                 1.s:463    .text:00000000000002c6 _xunhuan595
                 1.s:486    .text:00000000000002f4 _yanshi
                 1.s:470    .text:00000000000002d4 _xie595_0
                 1.s:472    .text:00000000000002d6 _suocun595
                 1.s:489    .text:00000000000002f8 _yanshi11
                 1.s:505    .text:0000000000000310 _lvboqimeidaohuanchongquding
                 1.s:508    .text:0000000000000314 _lvboqixunhuan
                 1.s:512    .text:000000000000031a _lvbozonghe
                 1.s:532    .text:0000000000000338 _lvboqimeidaohuanchongquding32
                 1.s:537    .text:0000000000000340 __fu_zhi_lv_bo_shu_ju
                 1.s:543    .text:000000000000034a __qu_diao_zui_da_zui_xiao
                 1.s:546    .text:000000000000034e __qu_diao_da
                 1.s:552    .text:0000000000000358 __di_zhi_jia
                 1.s:559    .text:0000000000000364 __xun_huan_jia
                 1.s:592    .text:0000000000000398 _chufafanhui
                 1.s:582    .text:0000000000000388 _chufaxunhuan
                 1.s:589    .text:0000000000000394 _chufaweishubudao0
                 1.s:611    .text:00000000000003b2 $d
                 1.s:611    .text:00000000000003b4 $d

NO UNDEFINED SYMBOLS
